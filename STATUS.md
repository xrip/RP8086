# RP8086 - –°—Ç–∞—Ç—É—Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

## ‚úÖ –§–∞–∑–∞ 1 –∑–∞–≤–µ—Ä—à–µ–Ω–∞: –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–±–æ—á–∏–π –ø—Ä–æ—Ç–æ—Ç–∏–ø

### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

#### 1. CPU —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (cpu.c / cpu.h)
- ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è clock –Ω–∞ GPIO29 (PWM, 33% duty cycle)
  - –ß–∞—Å—Ç–æ—Ç–∞: 100 Hz –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ (–ª–µ–≥–∫–æ –º–µ–Ω—è–µ—Ç—Å—è –≤ config.h)
  - –ü—Ä–∏ 400 MHz —Å–∏—Å—Ç–µ–º–Ω–æ–π —á–∞—Å—Ç–æ—Ç–µ: div=1000, wrap=3999, level=1320
- ‚úÖ RESET sequence –Ω–∞ GPIO27
  - –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ç–∞–π–º–∏–Ω–≥: 10 —Ç–∞–∫—Ç–æ–≤ LOW, 5 —Ç–∞–∫—Ç–æ–≤ —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏

#### 2. PIO –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä —à–∏–Ω—ã (i8086_bus.pio)
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ i8086 minimal mode (–±–µ–∑ CS)
- ‚úÖ 16-–±–∏—Ç–Ω–∞—è —à–∏–Ω–∞ –¥–∞–Ω–Ω—ã—Ö (AD0-AD15)
- ‚úÖ 20-–±–∏—Ç–Ω–∞—è –∞–¥—Ä–µ—Å–∞—Ü–∏—è (AD0-AD15 + A16-A19)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ RD/WR —Ü–∏–∫–ª–æ–≤
- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ READY –¥–ª—è wait states
- ‚úÖ –î–≤—É–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è —à–∏–Ω–∞ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ–º

**–†–∞—Å–ø–∏–Ω–æ–≤–∫–∞:**
```
GPIO 0-15  : AD0-AD15 (–º—É–ª—å—Ç–∏–ø–ª–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∞–¥—Ä–µ—Å/–¥–∞–Ω–Ω—ã–µ)
GPIO 16-19 : A16-A19 (—Å—Ç–∞—Ä—à–∏–µ –±–∏—Ç—ã –∞–¥—Ä–µ—Å–∞)
GPIO 20    : ALE (Address Latch Enable)
GPIO 21    : RD (Read strobe)
GPIO 22    : WR (Write strobe)
GPIO 23    : M/IO (Memory/IO select)
GPIO 24    : BHE (Bus High Enable)
GPIO 25    : INTR (Interrupt request to i8086, active HIGH)
GPIO 26    : INTA (Interrupt acknowledge from i8086, active LOW)
GPIO 27    : RESET (Reset output)
GPIO 28    : READY (Wait state control)
GPIO 29    : CLK (Clock output, 100 Hz)
```

#### 3. –≠–º—É–ª—è—Ü–∏—è –ø–∞–º—è—Ç–∏ (cpu_bus.c)
- ‚úÖ ROM: 8KB GlaBIOS (0xFE000-0xFFFFF)
- ‚úÖ RAM: 64KB (0x00000-0x0FFFF)
- ‚úÖ –ß—Ç–µ–Ω–∏–µ/–∑–∞–ø–∏—Å—å 16-–±–∏—Ç–Ω—ã—Ö —Å–ª–æ–≤ (little-endian)
- ‚úÖ –î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ M/IO –¥–ª—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –ø–∞–º—è—Ç—å/–ø–æ—Ä—Ç—ã

#### 4. I/O –ø–æ—Ä—Ç—ã
- ‚úÖ Port 0x00: Fibonacci generator (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

#### 5. –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π (pic.c / pic.h)
- ‚úÖ –≠–º—É–ª—è—Ü–∏—è 8259A PIC
- ‚úÖ INTR/INTA –ø—Ä–æ—Ç–æ–∫–æ–ª —á–µ—Ä–µ–∑ GPIO interrupt
- ‚úÖ Core1: –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä IRQ0 –∫–∞–∂–¥—ã–µ ~54.925ms (18.2 Hz, —Å—Ç–∞–Ω–¥–∞—Ä—Ç IBM PC)
- ‚úÖ INTA –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º READY —Å–∏–≥–Ω–∞–ª–æ–º
- ‚úÖ –û—Å—Ç–∞–Ω–æ–≤–∫–∞/–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ PIO SM –≤–æ –≤—Ä–µ–º—è INTA
- ‚úÖ –í—ã–¥–∞—á–∞ –≤–µ–∫—Ç–æ—Ä–∞ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è 0x08 (IRQ0)
- ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ `volatile` –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

#### 6. –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π
- ‚úÖ IRQ0: Write cycle handler
- ‚úÖ IRQ1: Read cycle handler
- ‚úÖ –í—ã—Å—à–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –¥–ª—è –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
- ‚úÖ Time-critical —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–∑–º–µ—â–µ–Ω—ã –≤ RAM

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

**–°–∏—Å—Ç–µ–º–Ω–∞—è —á–∞—Å—Ç–æ—Ç–∞:** 400 MHz (—Å —Ä–∞–∑–≥–æ–Ω–æ–º –∏ –ø–æ–≤—ã—à–µ–Ω–Ω—ã–º –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ–º)

**i8086 Clock:** 100 Hz –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
- –ü–µ—Ä–∏–æ–¥: 10 ms
- Duty cycle: 33% (3.3 ms HIGH, 6.7 ms LOW)

**–ó–∞–ø–∞—Å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:**
- 1 —Ç–∞–∫—Ç i8086 @ 100 Hz = 10 ms = 4,000,000 —Ç–∞–∫—Ç–æ–≤ RP2040
- IRQ latency: ~100 —Ç–∞–∫—Ç–æ–≤ RP2040
- –û–±—Ä–∞–±–æ—Ç–∫–∞ read/write: ~200 —Ç–∞–∫—Ç–æ–≤ RP2040
- **–ó–∞–ø–∞—Å: x10,000** - ARM —É—Å–ø–µ–≤–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∑–∞–ø—Ä–æ—Å –≤ —Ç—ã—Å—è—á–∏ —Ä–∞–∑ –±—ã—Å—Ç—Ä–µ–µ

### –ö–∞—Ä—Ç–∞ –ø–∞–º—è—Ç–∏

```
0x00000 - 0x0FFFF : RAM (64 KB)
0x10000 - 0xFDFFF : –ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ (–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 0xFFFF)
0xFE000 - 0xFFFFF : ROM GlaBIOS (8 KB)
```

**Reset vector:** 0xFFFF0 ‚Üí –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ ROM –ø–æ —Å–º–µ—â–µ–Ω–∏—é 0x1FF0

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
[i8086 CPU] ‚ÜêINTR/INTA‚Üí [pic.c Core0 GPIO IRQ]
     ‚Üï                            ‚Üì
[PIO State Machine] ‚ÜêIRQ0/1‚Üí [ARM Core0]
     ‚Üì                            ‚Üì
 GPIO 0-28                   [–≠–º—É–ª—è—Ç–æ—Ä]
                              RAM + ROM
                                  ‚Üë
                            [ARM Core1]
                          IRQ Generator
```

**–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏:**
- **PIO:** –í—Å—è –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã —Å —à–∏–Ω–æ–π (timing-critical)
  - –î–µ—Ç–µ–∫—Ç ALE, –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ RD/WR
  - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ READY
  - –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è —à–∏–Ω—ã –¥–∞–Ω–Ω—ã—Ö

- **ARM Core0:** –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö (–Ω–µ timing-critical)
  - –î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–¥—Ä–µ—Å–∞
  - –ß—Ç–µ–Ω–∏–µ/–∑–∞–ø–∏—Å—å RAM/ROM
  - I/O –ø–æ—Ä—Ç—ã
  - INTA GPIO interrupt handler
  - Main loop —Å __wfi()

- **ARM Core1:** –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π
  - IRQ0 timer (~54.925ms –ø–µ—Ä–∏–æ–¥, 18.2 Hz, IBM PC standard)
  - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ INTR —Å–∏–≥–Ω–∞–ª–æ–º
  - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ volatile —Ñ–ª–∞–≥–∏

### –¢–µ–∫—É—â–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. ‚ö†Ô∏è BHE –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è (—Ç–æ–ª—å–∫–æ 16-–±–∏—Ç–Ω—ã–µ word –æ–ø–µ—Ä–∞—Ü–∏–∏)
2. ‚ö†Ô∏è –¢–æ–ª—å–∫–æ 64KB RAM (RP2040 –ø–æ–∑–≤–æ–ª—è–µ—Ç –¥–æ 200KB+)
3. ‚ö†Ô∏è –ù–µ—Ç –ø–æ–ª–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ 8259A (—Ç–æ–ª—å–∫–æ –±–∞–∑–æ–≤—ã–π INTR/INTA)
4. ‚ö†Ô∏è –ù–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏ DMA

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∫–æ–¥–∞ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è)

1. ‚úÖ **–ü–æ—Ä—è–¥–æ–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏ RD/WR –≤ PIO**
   - –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è RD (80% –æ–ø–µ—Ä–∞—Ü–∏–π), –ø–æ—Ç–æ–º WR (20%)
   - –≠–∫–æ–Ω–æ–º–∏—è ~3 —Ç–∞–∫—Ç–∞ PIO –Ω–∞ –∫–∞–∂–¥–æ–º read —Ü–∏–∫–ª–µ

2. ‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è**
   - –ü–æ—Ä—è–¥–æ–∫: clock ‚Üí bus ‚Üí reset
   - PIO –≥–æ—Ç–æ–≤–∞ –¥–æ –∑–∞–ø—É—Å–∫–∞ CPU

3. ‚úÖ **USB –æ—Ç–ª–∞–¥–∫–∞**
   - `stdio_usb_init()` –≤–º–µ—Å—Ç–æ `stdio_init_all()`
   - –ó–∞–¥–µ—Ä–∂–∫–∞ 2.5 —Å–µ–∫ –¥–ª—è —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏ USB

4. ‚úÖ **–ß–∏—Å—Ç—ã–π –∫–æ–¥**
   - `public` defines —Ç–æ–ª—å–∫–æ –¥–ª—è C
   - Private defines –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ PIO –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
   - –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ

### –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚ö° **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –∂–µ–ª–µ–∑–µ**
   - –û—Å—Ü–∏–ª–ª–æ–≥—Ä–∞—Ñ –Ω–∞ GPIO29 (CLK): 100 Hz, 33% duty
   - –û—Å—Ü–∏–ª–ª–æ–≥—Ä–∞—Ñ –Ω–∞ GPIO27 (RESET): –∏–º–ø—É–ª—å—Å ~100ms
   - –õ–æ–≥–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –Ω–∞ GPIO 0-15, 20-24 (bus cycles)

2. üöÄ **–£–≤–µ–ª–∏—á–µ–Ω–∏–µ —á–∞—Å—Ç–æ—Ç—ã**
   - 100 Hz ‚Üí 1 kHz ‚Üí 100 kHz ‚Üí 1 MHz ‚Üí 5 MHz
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ –Ω–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ
   - –ú–∞–∫—Å–∏–º—É–º –±–µ–∑–æ–ø–∞—Å–Ω–æ: 6-7 MHz (–∑–∞–ø–∞—Å 2x)

3. üîß **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å**
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ BHE –¥–ª—è byte –æ–ø–µ—Ä–∞—Ü–∏–π
   - –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ RAM –¥–æ 256KB
   - I/O —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (UART, PIT)
   - –ü–æ–ª–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å 8259A (ICW1-ICW4, OCW1-OCW3, –º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ IRQ)

### –°–±–æ—Ä–∫–∞

```bash
mkdir build
cd build
cmake ..
make
```

–†–µ–∑—É–ª—å—Ç–∞—Ç: `MultiIO.uf2`

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. –ó–∞–≥—Ä—É–∑–∏—Ç—å `MultiIO.uf2` –Ω–∞ RP2040
2. –ü–æ–¥–∫–ª—é—á–∏—Ç—å –æ—Å—Ü–∏–ª–ª–æ–≥—Ä–∞—Ñ –∫ GPIO29 (CLK) - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 100 Hz, 33% duty
3. –ü–æ–¥–∫–ª—é—á–∏—Ç—å –æ—Å—Ü–∏–ª–ª–æ–≥—Ä–∞—Ñ –∫ GPIO27 (RESET) - –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∏–º–ø—É–ª—å—Å ~100ms –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
4. –ü–æ–¥–∫–ª—é—á–∏—Ç—å –æ—Å—Ü–∏–ª–ª–æ–≥—Ä–∞—Ñ –∫ GPIO20 (ALE) - –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è —Ü–∏–∫–ª—ã —á—Ç–µ–Ω–∏—è –ø–æ—Å–ª–µ reset
5. –ü–æ–¥–∫–ª—é—á–∏—Ç—å –ª–æ–≥–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –∫ GPIO 0-15, 20-24 –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ bus cycles

### –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

- –ù–µ—Ç :)

## –í–∫–ª–∞–¥ –≤ –ø—Ä–æ–µ–∫—Ç

- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞: –∞–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–¥ i8086 minimal mode
- PIO –ø—Ä–æ–≥—Ä–∞–º–º–∞: –ø–æ–ª–Ω–∞—è –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞ –¥–ª—è 16-–±–∏—Ç —à–∏–Ω—ã
- –≠–º—É–ª—è—Ü–∏—è –ø–∞–º—è—Ç–∏: ROM + RAM
- –†–∞–∑–≥–æ–Ω: —Å—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –Ω–∞ 400 MHz
