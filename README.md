# RP8086 - –ß–∏–ø—Å–µ—Ç i8086 –Ω–∞ –±–∞–∑–µ RP2040

## –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

RP8086 - —ç—Ç–æ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ-–∞–ø–ø–∞—Ä–∞—Ç–Ω—ã–π –∫–æ–º–ø–ª–µ–∫—Å, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–π –∫–∏—Ç–∞–π—Å–∫—É—é —Ñ–∏–æ–ª–µ—Ç–æ–≤—É—é –ø–ª–∞—Ç—É RP2040 (Raspberry Pi Pico) –≤ –∫–∞—á–µ—Å—Ç–≤–µ —á–∏–ø—Å–µ—Ç–∞ –¥–ª—è –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞ Intel 8086. RP2040 —ç–º—É–ª–∏—Ä—É–µ—Ç:

- ‚úÖ –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä —Å–∏—Å—Ç–µ–º–Ω–æ–π —à–∏–Ω—ã (PIO hardware)
- ‚úÖ –≠–º—É–ª—è—Ç–æ—Ä ROM (8KB Turbo XT BIOS v3.1)
- ‚úÖ –≠–º—É–ª—è—Ç–æ—Ä RAM (192KB)
- ‚úÖ –í–∏–¥–µ–æ–ø–∞–º—è—Ç—å MDA (4KB —Å real-time –≤—ã–≤–æ–¥–æ–º 60 FPS)
- ‚úÖ I/O –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä —Å —ç–º—É–ª—è—Ü–∏–µ–π VGA –∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–Ω—ã—Ö –ø–æ—Ä—Ç–æ–≤
- ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ç–∞–∫—Ç–æ–≤–æ–≥–æ —Å–∏–≥–Ω–∞–ª–∞ (PWM, 4 MHz, 33% duty cycle)
- ‚úÖ –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º–∏ (IRQ0 timer + IRQ1 keyboard)
- ‚úÖ –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ IBM PC/XT (ASCII ‚Üí Scancode –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä, –ø–æ—Ä—Ç—ã 0x60/0x64)

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ**: RP2040 —Ç–æ–ª–µ—Ä–∞–Ω—Ç–Ω–∞ –∫ 5–í –Ω–∞ –≤—Ö–æ–¥–µ, –ø–æ—ç—Ç–æ–º—É –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ level shifters –Ω–µ —Ç—Ä–µ–±—É—é—Ç—Å—è –¥–ª—è –ø—Ä—è–º–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ i8086.

**–°—Ç–∞—Ç—É—Å**: –†–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ –Ω–∞ 4 –ú–ì—Ü —Å –ø–æ–ª–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –∏ –≤–∏–¥–µ–æ.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –î–≤—É—Ö—É—Ä–æ–≤–Ω–µ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—É—é –¥–≤—É—Ö—É—Ä–æ–≤–Ω–µ–≤—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É, –∫–æ—Ç–æ—Ä–∞—è —Ä–∞–∑–¥–µ–ª—è–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É —à–∏–Ω—ã –º–µ–∂–¥—É –∞–ø–ø–∞—Ä–∞—Ç–Ω—ã–º –∏ –ø—Ä–æ–≥—Ä–∞–º–º–Ω—ã–º –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ–º:

**–£—Ä–æ–≤–µ–Ω—å 1: PIO (–ê–ø–ø–∞—Ä–∞—Ç–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å - i8086_bus.pio)**
- –†–∞–±–æ—Ç–∞–µ—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –Ω–∞ state machine PIO RP2040
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏ —à–∏–Ω—ã –≤ –∞–ø–ø–∞—Ä–∞—Ç–Ω–æ–º –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–∏
- –£–ø—Ä–∞–≤–ª—è–µ—Ç —Å–∏–≥–Ω–∞–ª–∞–º–∏ —à–∏–Ω—ã i8086: ALE, RD, WR, M/IO, BHE, READY
- –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç –¥–≤—É–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—É—é —à–∏–Ω—É –¥–∞–Ω–Ω—ã—Ö (GPIO 0-15)
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è (IRQ0 –¥–ª—è –∑–∞–ø–∏—Å–∏, IRQ1 –¥–ª—è —á—Ç–µ–Ω–∏—è, IRQ3 –¥–ª—è INTA)
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –ø–æ –≤—Ä–µ–º–µ–Ω–∏ —Å sideset –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏ –∏ —Å–æ–∫—Ä–∞—â–µ–Ω–Ω—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π
- –ú–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞ —á–∞—Å—Ç–æ—Ç–µ –¥–æ 133 –ú–ì—Ü –¥–ª—è –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç–∞–π–º–∏–Ω–≥–æ–≤

**–£—Ä–æ–≤–µ–Ω—å 2: ARM Cortex-M0+ (–ü—Ä–æ–≥—Ä–∞–º–º–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å - cpu_bus.c)**
- –û–±—Å–ª—É–∂–∏–≤–∞–µ—Ç –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è –æ—Ç PIO —á–µ—Ä–µ–∑ FIFO
- –†–µ–∞–ª–∏–∑—É–µ—Ç —Ñ–∞–∫—Ç–∏—á–µ—Å–∫—É—é –ª–æ–≥–∏–∫—É —ç–º—É–ª—è—Ü–∏–∏ –ø–∞–º—è—Ç–∏/I/O
- –í—Å–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –º–∞–∫—Ä–æ—Å `__time_critical_func` –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏–∑ RAM
- –ü—Ä–µ—Ä—ã–≤–∞–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º `PICO_HIGHEST_IRQ_PRIORITY`

### –ú–Ω–æ–≥–æ—è–¥–µ—Ä–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–≤—É—Ö—ä—è–¥–µ—Ä–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É RP2040 —Å —á–µ—Ç–∫–∏–º —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –∑–∞–¥–∞—á:

**Core0 (User Interface & I/O):**
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã (overclock 400 MHz, USB setup)
- –ó–∞–ø—É—Å–∫ Core1 —á–µ—Ä–µ–∑ `multicore_launch_core1(bus_handler_core)`
- –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª:
  - **–†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –≤–∏–¥–µ–æ**: 60 FPS –≤—ã–≤–æ–¥ VIDEORAM (25√ó80 MDA) –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª
  - **–û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã**: USB serial ‚Üí ASCII ‚Üí IBM PC/XT Scancode
  - **Debug –∫–æ–º–∞–Ω–¥—ã**: R (reset), B (bootloader), M/V/P (dumps)
  - **–ò–Ω–∂–µ–∫—Ç —Å–∫–∞–Ω-–∫–æ–¥–æ–≤**: `push_scancode()` ‚Üí keyboard buffer ‚Üí IRQ1
- –†–∞–±–æ—Ç–∞–µ—Ç –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ —Å `tight_loop_contents()`, –±–µ–∑ WFI

**Core1 (Bus & IRQ Management):**
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∂–µ–ª–µ–∑–∞: `start_cpu_clock()` ‚Üí `pic_init()` ‚Üí `cpu_bus_init()` ‚Üí `reset_cpu()`
- –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª:
  - **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–∞–π–º–µ—Ä–∞**: IRQ0 –∫–∞–∂–¥—ã–µ 54.925ms (18.2 Hz, IBM PC 8253/8254 —Å—Ç–∞–Ω–¥–∞—Ä—Ç)
  - **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ INTR**: –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç INTR=HIGH –ø—Ä–∏ `current_irq_vector != 0`
  - **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã**: IRQ0 (timer) > IRQ1 (keyboard)
- IRQ handlers (`bus_read_handler`, `bus_write_handler`) —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–∞ –æ–±–æ–∏—Ö —è–¥—Ä–∞—Ö —Å `PICO_HIGHEST_IRQ_PRIORITY`

**–ü—Ä–æ—Ç–æ–∫–æ–ª INTA (State Machine PIO):**
- **INTA –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –≤ PIO**: –í `i8086_bus.pio` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω `INTA_cycle`
- **–ü—Ä–æ—Ü–µ—Å—Å INTA**:
  1. PIO –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç INTA=LOW –ø–æ—Å–ª–µ ALE
  2. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç IRQ 3 –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç READY=1 (wait state)
  3. –ñ–¥–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ü–∏–∫–ª–∞ INTA (INTA=HIGH ‚Üí INTA=LOW)
  4. –ü–µ—Ä–µ–¥–∞–µ—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤ –æ–±—ã—á–Ω—ã–π —Ü–∏–∫–ª —á—Ç–µ–Ω–∏—è
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤ ARM**: `bus_read_handler()` –ø–æ–ª—É—á–∞–µ—Ç IRQ 3
  - –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π —Ñ–ª–∞–≥ `irq_pending = true`
  - –°–±—Ä–∞—Å—ã–≤–∞–µ—Ç INTR=0 —á–µ—Ä–µ–∑ `gpio_put(INTR_PIN, 0)`
  - –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º —á—Ç–µ–Ω–∏–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `current_irq_vector` (0xFF08 –¥–ª—è IRQ0, 0xFF09 –¥–ª—è IRQ1)
  - –û—á–∏—â–∞–µ—Ç –≤–µ–∫—Ç–æ—Ä: `irq_pending = current_irq_vector = 0`

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ GPIO

| GPIO | –°–∏–≥–Ω–∞–ª | –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|--------|-------------|----------|
| 0-15 | AD0-AD15 | –î–≤—É–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è | –ú—É–ª—å—Ç–∏–ø–ª–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —à–∏–Ω–∞ –∞–¥—Ä–µ—Å–∞/–¥–∞–Ω–Ω—ã—Ö (16 –±–∏—Ç) |
| 16-19 | A16-A19 | –í—Ö–æ–¥ | –°—Ç–∞—Ä—à–∏–µ –±–∏—Ç—ã –∞–¥—Ä–µ—Å–∞ (4 –±–∏—Ç–∞) |
| 20 | ALE | –í—Ö–æ–¥ | Address Latch Enable - –∑–∞—â–µ–ª–∫–∞ –∞–¥—Ä–µ—Å–∞ |
| 21 | RD | –í—Ö–æ–¥ | Read strobe - —Å–∏–≥–Ω–∞–ª —á—Ç–µ–Ω–∏—è (–∞–∫—Ç–∏–≤–Ω—ã–π LOW) |
| 22 | WR | –í—Ö–æ–¥ | Write strobe - —Å–∏–≥–Ω–∞–ª –∑–∞–ø–∏—Å–∏ (–∞–∫—Ç–∏–≤–Ω—ã–π LOW) |
| 23 | INTA | –í—Ö–æ–¥ | Interrupt acknowledge –æ—Ç i8086 (–∞–∫—Ç–∏–≤–Ω—ã–π LOW) |
| 24 | M/IO | –í—Ö–æ–¥ | Memory/IO select (1=–ø–∞–º—è—Ç—å, 0=I/O) |
| 25 | BHE | –í—Ö–æ–¥ | Bus High Enable (–ø–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ 8/16 –±–∏—Ç) |
| 26 | INTR | –í—ã—Ö–æ–¥ | Interrupt request –¥–ª—è i8086 (–∞–∫—Ç–∏–≤–Ω—ã–π HIGH) |
| 27 | READY | –í—ã—Ö–æ–¥ | Wait state control –¥–ª—è CPU (0=wait, 1=ready) |
| 28 | RESET | –í—ã—Ö–æ–¥ | Reset –¥–ª—è i8086 (–∞–∫—Ç–∏–≤–Ω—ã–π LOW) |
| 29 | CLK | –í—ã—Ö–æ–¥ | –¢–∞–∫—Ç–æ–≤—ã–π —Å–∏–≥–Ω–∞–ª –¥–ª—è i8086 (PWM, 4 –ú–ì—Ü) |


## –ü—Ä–æ—Ç–æ–∫–æ–ª —Ä–∞–±–æ—Ç—ã —à–∏–Ω—ã

### –¶–∏–∫–ª —á—Ç–µ–Ω–∏—è (RD)

1. **T1 —Ñ–∞–∑–∞ (wait_ALE)**: CPU –≤—ã—Å—Ç–∞–≤–ª—è–µ—Ç –∞–¥—Ä–µ—Å –Ω–∞ AD0-AD15 + A16-A19, –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç ALE=HIGH
   - PIO –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ `wait_ALE` –∏ –∂–¥–µ—Ç `wait 1 gpio ALE_PIN`

2. **T2 —Ñ–∞–∑–∞ (capture_address)**:
   - PIO –≤—ã–ø–æ–ª–Ω—è–µ—Ç `wait 0 gpio ALE_PIN side 1` - –∑–∞—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –∞–¥—Ä–µ—Å, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç READY=1 (wait state)
   - `in pins, 26` –∑–∞—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç 26 GPIO –ø–∏–Ω–æ–≤ (–∞–¥—Ä–µ—Å + —É–ø—Ä–∞–≤–ª—è—é—â–∏–µ —Å–∏–≥–Ω–∞–ª—ã)
   - `push` –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç 26 –±–∏—Ç –≤ FIFO –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ ARM
   - **ISR —Å—Ç—Ä—É–∫—Ç—É—Ä–∞**: `[AD0-AD15][A16-A19][ALE][RD][WR][INTA][MIO][BHE]`

3. **T2-T3 —Ñ–∞–∑–∞ (wait_strobe)**:
   - PIO –æ–ø—Ä–∞—à–∏–≤–∞–µ—Ç —É–ø—Ä–∞–≤–ª—è—é—â–∏–µ —Å–∏–≥–Ω–∞–ª—ã —á–µ—Ä–µ–∑ `mov osr, pins`
   - `out null, 21` –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç GPIO 0-20, –æ—Å—Ç–∞–≤–ª—è—è RD/WR/INTA
   - –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç RD, WR, INTA —á–µ—Ä–µ–∑ `out x, 1` –∏ `jmp !x`

4. **T3 —Ñ–∞–∑–∞ (RD_cycle)**:
   - `irq 1` –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ —á—Ç–µ–Ω–∏—è –¥–ª—è ARM
   - `mov osr, !null` + `out pindirs, 16` –ø–µ—Ä–µ–≤–æ–¥–∏—Ç AD0-AD15 –≤ —Ä–µ–∂–∏–º –≤—ã—Ö–æ–¥–∞
   - `pull block` –±–ª–æ–∫–∏—Ä—É—é—â–µ –∂–¥–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ—Ç ARM
   - `out pins, 16 side 1` –≤—ã–≤–æ–¥–∏—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞ —à–∏–Ω—É, –æ–ø—É—Å–∫–∞–µ—Ç READY=0

5. **T4 —Ñ–∞–∑–∞ (cleanup)**:
   - `wait 1 gpio RD_PIN` –∂–¥–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ü–∏–∫–ª–∞ —á—Ç–µ–Ω–∏—è
   - `mov osr, null` + `out pindirs, 16` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç AD0-AD15 –≤ Z-—Å–æ—Å—Ç–æ—è–Ω–∏–µ
   - `jmp wait_ALE` –≤–æ–∑–≤—Ä–∞—Ç –≤ –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

### –¶–∏–∫–ª –∑–∞–ø–∏—Å–∏ (WR)

1. **T1-T2 —Ñ–∞–∑—ã**: –ê–Ω–∞–ª–æ–≥–∏—á–Ω—ã —Ü–∏–∫–ª—É —á—Ç–µ–Ω–∏—è (–∑–∞—Ö–≤–∞—Ç –∞–¥—Ä–µ—Å–∞ –∏ —É–ø—Ä–∞–≤–ª—è—é—â–∏—Ö —Å–∏–≥–Ω–∞–ª–æ–≤)

2. **T3 —Ñ–∞–∑–∞ (WR_cycle)**:
   - `in pins, 16` –∑–∞—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç 16 –±–∏—Ç –¥–∞–Ω–Ω—ã—Ö —Å AD0-AD15
   - `push side 1` –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ FIFO, –æ–ø—É—Å–∫–∞–µ—Ç READY=0
   - `irq 0` –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –¥–ª—è ARM —Å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π
   - `wait 1 gpio WR_PIN` –∂–¥–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ü–∏–∫–ª–∞ –∑–∞–ø–∏—Å–∏

3. **–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ**:
   - PIO –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ `wait_ALE` –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ü–∏–∫–ª–∞

### –¶–∏–∫–ª INTA (Interrupt Acknowledge)

1. **–û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ INTA**: PIO –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç INTA=LOW –≤ —Ü–∏–∫–ª–µ `wait_strobe`

2. **INTA_cycle**:
   - `irq 3 side 1` –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ –¥–ª—è ARM, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç READY=1 (wait state)
   - `wait 1 gpio INTA_PIN` –∂–¥–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è INTA (–ø–µ—Ä–µ—Ö–æ–¥ –≤ HIGH)
   - –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ–∂–∏–¥–∞–Ω–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å ALE
   - `wait 0 gpio INTA_PIN` –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏–µ –≤–æ –≤—Ç–æ—Ä–æ–º —Ü–∏–∫–ª–µ INTA

3. **–ü–µ—Ä–µ—Ö–æ–¥ –≤ —á—Ç–µ–Ω–∏–µ**: –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è INTA —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ –æ–±—ã—á–Ω—ã–π —Ü–∏–∫–ª —á—Ç–µ–Ω–∏—è
   - ARM –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `irq_pending1 = true`
   - –°–ª–µ–¥—É—é—â–∏–π —Ü–∏–∫–ª —á—Ç–µ–Ω–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤–µ–∫—Ç–æ—Ä –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è (0x08)

### –ü–∞—Ä—Å–∏–Ω–≥ —Å–æ—Å—Ç–æ—è–Ω–∏—è —à–∏–Ω—ã (parse_bus_state)

–§—É–Ω–∫—Ü–∏—è `parse_bus_state()` –≤ cpu_bus.c –∏–∑–≤–ª–µ–∫–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ 26-–±–∏—Ç–Ω–æ–≥–æ —Å–ª–æ–≤–∞ PIO:

```c
info.address = bus_data & 0xFFFFF;       // Bits [19:0] - AD0-AD15 + A16-A19
info.ale     = (bus_data >> 20) & 1;     // Bit [20] - ALE
info.rd      = (bus_data >> 21) & 1;     // Bit [21] - RD
info.wr      = (bus_data >> 22) & 1;     // Bit [22] - WR
info.inta    = (bus_data >> 23) & 1;     // Bit [23] - INTA
info.m_io    = (bus_data >> 24) & 1;     // Bit [24] - M/IO
info.bhe     = (bus_data >> 25) & 1;     // Bit [25] - BHE
```

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è FIFO –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π

**IRQ0 (Write):**
- –û–±—Ä–∞–±–æ—Ç—á–∏–∫ `bus_write_handler()` —á–∏—Ç–∞–µ—Ç 2 –∑–∞–ø–∏—Å–∏ –∏–∑ FIFO:
  1. –ê–¥—Ä–µ—Å + —É–ø—Ä–∞–≤–ª—è—é—â–∏–µ —Å–∏–≥–Ω–∞–ª—ã
  2. 16-–±–∏—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å —à–∏–Ω—ã AD0-AD15
- –í—ã–∑—ã–≤–∞–µ—Ç `i8086_write(address, data, is_memory, bhe)`
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –≤—ã—Ä–æ–≤–Ω–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

**IRQ1 (Read):**
- –û–±—Ä–∞–±–æ—Ç—á–∏–∫ `bus_read_handler()` —á–∏—Ç–∞–µ—Ç –∞–¥—Ä–µ—Å –∏–∑ FIFO
- –í—ã–∑—ã–≤–∞–µ—Ç `i8086_read(address, is_memory)` –∏–ª–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤–µ–∫—Ç–æ—Ä –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç 16-–±–∏—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ–±—Ä–∞—Ç–Ω–æ –≤ PIO FIFO

**IRQ3 (INTA):**
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ñ–ª–∞–≥ `irq_pending1 = true`
- –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º —á—Ç–µ–Ω–∏–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤–µ–∫—Ç–æ—Ä –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è 0x08
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç INTR=0

## –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### –≠–º—É–ª—è—Ü–∏—è –ø–∞–º—è—Ç–∏

**RAM (192KB):**
- –î–∏–∞–ø–∞–∑–æ–Ω: 0x00000 - 0x2FFFF
- –ú–∞—Å—Å–∏–≤ `RAM[RAM_SIZE]` —Å 4-byte alignment
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ 8/16 –±–∏—Ç–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —á–µ—Ä–µ–∑ BHE –∏ A0
- **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è**: –ü—Ä—è–º–æ–π 16-–±–∏—Ç–Ω—ã–π –¥–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ `*(uint16_t *)&RAM[address]`
- **–£–≤–µ–ª–∏—á–µ–Ω —Å–æ 128KB**: –£–¥–∞–ª–µ–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è, –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∞ –ø–∞–º—è—Ç—å

**ROM (8KB Turbo XT BIOS v3.1):**
- –î–∏–∞–ø–∞–∑–æ–Ω: 0xFE000 - 0xFFFFF
- –ú–∞—Å—Å–∏–≤ `BIOS[]` —Å 4-byte alignment (–ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω –∏–∑ GLABIOS_0_4_1_8T_ROM)
- –¢–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ, 16-–±–∏—Ç–Ω—ã–π –¥–æ—Å—Ç—É–ø
- –í–µ–∫—Ç–æ—Ä —Å–±—Ä–æ—Å–∞ –ø–æ –∞–¥—Ä–µ—Å—É 0xFFFF0 —É–∫–∞–∑—ã–≤–∞–µ—Ç –≤ ROM
- –î–∞—Ç–∞ —Ä–µ–ª–∏–∑–∞ BIOS: 10/28/2017

**–í–∏–¥–µ–æ–ø–∞–º—è—Ç—å MDA (4KB):**
- –î–∏–∞–ø–∞–∑–æ–Ω: 0xB0000 - 0xB0FFF
- –ú–∞—Å—Å–∏–≤ `VIDEORAM[4096]` –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ —Ä–µ–∂–∏–º–∞ (25√ó80 —Å–∏–º–≤–æ–ª–æ–≤)
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ 8/16 –±–∏—Ç–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –∑–∞–ø–∏—Å–∏
- **Real-time –≤—ã–≤–æ–¥**: Core0 —Ä–µ–Ω–¥–µ—Ä–∏—Ç –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª —Å —á–∞—Å—Ç–æ—Ç–æ–π 60 FPS —á–µ—Ä–µ–∑ ANSI escape codes
- –†—É—á–Ω–æ–π –¥–∞–º–ø —á–µ—Ä–µ–∑ USB –∫–æ–º–∞–Ω–¥—É 'V' (–ø–µ—Ä–≤—ã–µ 5 —Å—Ç—Ä–æ–∫)

### –≠–º—É–ª–∏—Ä—É–µ–º—ã–µ I/O –ø–æ—Ä—Ç—ã

**–ê–ø–ø–∞—Ä–∞—Ç–Ω—ã–µ –ø–æ—Ä—Ç—ã (—ç–º—É–ª—è—Ü–∏—è):**
| –ü–æ—Ä—Ç | –û–ø–∏—Å–∞–Ω–∏–µ | –í–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ |
|------|----------|---------------------|
| 0x3BA | VGA Status Register | –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ vsync –±–∏—Ç–∞ (—ç–º—É–ª—è—Ü–∏—è) |
| 0x60 | Keyboard Data Port | –°–∫–∞–Ω-–∫–æ–¥—ã –∏–∑ circular buffer (IBM PC/XT Set 1) |
| 0x64 | Keyboard Status Port | Bit 0 = –¥–∞–Ω–Ω—ã–µ –¥–æ—Å—Ç—É–ø–Ω—ã (1 = –µ—Å—Ç—å, 0 = –Ω–µ—Ç) |

**–û–±—â–∏–µ –ø–æ—Ä—Ç—ã:**
- –ü–æ—Ä—Ç—ã 0x000-0xFFF –¥–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è —ç–º—É–ª—è—Ü–∏–∏ (–º–∞—Å—Å–∏–≤ `PORTS[]`)
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ 8/16 –±–∏—Ç–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —á–µ—Ä–µ–∑ BHE
- –ß—Ç–µ–Ω–∏–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 0xFFFF –¥–ª—è –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö –ø–æ—Ä—Ç–æ–≤

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ—Ä—Ç–æ–≤:**
- VGA –ø–æ—Ä—Ç (0x3BA) –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –ø–µ—Ä–≤—ã–º (—Å–∞–º—ã–π —á–∞—Å—Ç—ã–π –¥–æ—Å—Ç—É–ø)
- –ö–ª–∞–≤–∏–∞—Ç—É—Ä–Ω—ã–µ –ø–æ—Ä—Ç—ã (0x60-0x6F) –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è —á–µ—Ä–µ–∑ –¥–∏–∞–ø–∞–∑–æ–Ω–Ω—É—é –º–∞—Å–∫—É: `(port & 0xFF0) == 0x60`
- –≠–∫–æ–Ω–æ–º–∏—è 2-3 —Ç–∞–∫—Ç–∞ RP2040 –Ω–∞ –∫–∞–∂–¥–æ–π I/O –æ–ø–µ—Ä–∞—Ü–∏–∏

### –û–±—Ä–∞–±–æ—Ç–∫–∞ BHE (Bus High Enable)

–§—É–Ω–∫—Ü–∏–∏ `i8086_read()` –∏ `i8086_write()` –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç –ø–æ–ª–Ω—É—é 8/16 –±–∏—Ç–Ω—É—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:

```c
// –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø–æ BHE –∏ A0
if (!bhe && !a0) {
    // 16-bit transfer: BHE=0, A0=0
    *(uint16_t *) &ram[address] = data;
} else if (bhe && !a0) {
    // Byte transfer –Ω–∞ —á–µ—Ç–Ω–æ–º –∞–¥—Ä–µ—Å–µ: BHE=1, A0=0 (–º–ª–∞–¥—à–∏–π –±–∞–π—Ç)
    ram[address] = data & 0xFF;
} else if (!bhe && a0) {
    // Byte transfer –Ω–∞ –Ω–µ—á–µ—Ç–Ω–æ–º –∞–¥—Ä–µ—Å–µ: BHE=0, A0=1 (—Å—Ç–∞—Ä—à–∏–π –±–∞–π—Ç)
    ram[address] = (data >> 8) & 0xFF;
}
// BHE=1, A0=1 - –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º–∞—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—è, –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è
```

### –°–∏—Å—Ç–µ–º–∞ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π

**IRQ Management:**
- –ï–¥–∏–Ω–∞—è –≥–ª–æ–±–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è: `current_irq_vector` (uint16_t)
- –ó–Ω–∞—á–µ–Ω–∏—è: 0 (–Ω–µ—Ç IRQ), 0xFF08 (IRQ0 timer), 0xFF09 (IRQ1 keyboard)
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: IRQ0 > IRQ1 (—á–µ—Ä–µ–∑ —É—Å–ª–æ–≤–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É –≤ `push_scancode()`)

**IRQ0 (Timer) - Core1:**
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 54.925ms (18.2 Hz, IBM PC 8253/8254 —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å)
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `absolute_time_t` –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ —Ç–∞–π–º–∏–Ω–≥–∞
- –ë–µ–∑—É—Å–ª–æ–≤–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `current_irq_vector = 0xFF08`

**IRQ1 (Keyboard) - Core0:**
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Å–∫–∞–Ω-–∫–æ–¥–∞ –≤ –±—É—Ñ–µ—Ä
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞: `if (!current_irq_vector)` –ø–µ—Ä–µ–¥ —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π 0xFF09
- Circular buffer –Ω–∞ 16 –±–∞–π—Ç –¥–ª—è —Å–∫–∞–Ω-–∫–æ–¥–æ–≤

**INTA Protocol:**
- PIO –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç INTA=LOW —á–µ—Ä–µ–∑ `INTA_cycle` (IRQ 3)
- ARM —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `irq_pending = true` –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ IRQ3
- –°–±—Ä–∞—Å—ã–≤–∞–µ—Ç INTR=0 —á–µ—Ä–µ–∑ `gpio_put(INTR_PIN, 0)`
- –°–ª–µ–¥—É—é—â–∏–π —Ü–∏–∫–ª —á—Ç–µ–Ω–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `current_irq_vector`
- –û—á–∏—â–∞–µ—Ç: `irq_pending = current_irq_vector = 0`

### USB –∫–æ–º–∞–Ω–¥—ã (main.c)

**–°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã (uppercase, –ù–ï –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ i8086):**

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ | –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å |
|---------|----------|-----------------|
| **'M'** | –î–∞–º–ø –ø–∞–º—è—Ç–∏ | –í—ã–≤–æ–¥–∏—Ç –ø–µ—Ä–≤—ã–µ 1024 –±–∞–π—Ç RAM |
| **'V'** | –î–∞–º–ø –≤–∏–¥–µ–æ–ø–∞–º—è—Ç–∏ | –í—ã–≤–æ–¥–∏—Ç –ø–µ—Ä–≤—ã–µ 5 —Å—Ç—Ä–æ–∫ √ó 80 —Å–∏–º–≤–æ–ª–æ–≤ –∏–∑ VIDEORAM |
| **'P'** | –î–∞–º–ø –ø–æ—Ä—Ç–æ–≤ | –í—ã–≤–æ–¥–∏—Ç –ø–µ—Ä–≤—ã–µ 1024 –±–∞–π—Ç –º–∞—Å—Å–∏–≤–∞ PORTS |
| **'R'** | –°–±—Ä–æ—Å CPU | –°–±—Ä–∞—Å—ã–≤–∞–µ—Ç INTR, –≤—ã–ø–æ–ª–Ω—è–µ—Ç –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å reset_cpu() |
| **'B'** | Bootloader | –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç RP2040 –≤ bootloader mode (–¥–ª—è –ø—Ä–æ—à–∏–≤–∫–∏) |

**–û–±—ã—á–Ω—ã–π –≤–≤–æ–¥ (–ª—é–±—ã–µ –¥—Ä—É–≥–∏–µ —Å–∏–º–≤–æ–ª—ã):**
- –í—Å–µ —Å–∏–º–≤–æ–ª—ã, –∫—Ä–æ–º–µ uppercase –∫–æ–º–∞–Ω–¥, –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –≤ IBM PC/XT —Å–∫–∞–Ω-–∫–æ–¥—ã
- –û—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ i8086 —á–µ—Ä–µ–∑ keyboard buffer (–ø–æ—Ä—Ç 0x60)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è IRQ1 –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Å–∫–∞–Ω-–∫–æ–¥–∞
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞: a-z, A-Z, 0-9, Space, Enter, Backspace, Tab, Escape

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–≤–æ–¥:**
- –í–∏–¥–µ–æ–ø–∞–º—è—Ç—å (MDA 25√ó80) —Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª —Å —á–∞—Å—Ç–æ—Ç–æ–π 60 FPS (Core0)

### –ö–∞—Ä—Ç–∞ –ø–∞–º—è—Ç–∏

```
0x00000 - 0x2FFFF : RAM (192KB) - –æ—Å–Ω–æ–≤–Ω–∞—è –ø–∞–º—è—Ç—å, 4-byte aligned
0x30000 - 0xAFFFF : Unmapped (returns 0xFFFF)
0xB0000 - 0xB0FFF : Video RAM MDA (4KB) - —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º 25√ó80
0xB1000 - 0xFDFFF : Unmapped (returns 0xFFFF)
0xFE000 - 0xFFFFF : ROM Turbo XT BIOS v3.1 (8KB) - 4-byte aligned
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- Reset vector at 0xFFFF0 ‚Üí points into ROM
- RAM —É–≤–µ–ª–∏—á–µ–Ω–∞ —Å 128KB –¥–æ 192KB
- Video RAM –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –º–∞—Å—Å–∏–≤–µ `VIDEORAM[4096]`
- I/O –ø–æ—Ä—Ç—ã –≤ –º–∞—Å—Å–∏–≤–µ `PORTS[0xFFF]` (2-byte aligned)

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
RP8086/
‚îú‚îÄ‚îÄ main.c              # Core0: UI, video rendering, keyboard input
‚îú‚îÄ‚îÄ cpu.c/h             # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ i8086 (clock, reset)
‚îú‚îÄ‚îÄ cpu_bus.c/h         # Core1: bus handlers, memory emulation, IRQ system
‚îú‚îÄ‚îÄ i8086_bus.pio       # PIO –ø—Ä–æ–≥—Ä–∞–º–º–∞ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ —à–∏–Ω—ã —Å INTA –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π
‚îú‚îÄ‚îÄ config.h            # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è GPIO, —Å–∏—Å—Ç–µ–º—ã, likely/unlikely –º–∞–∫—Ä–æ—Å—ã
‚îú‚îÄ‚îÄ bios.h              # Turbo XT BIOS v3.1 ROM –æ–±—Ä–∞–∑ (8KB array BIOS[])
‚îú‚îÄ‚îÄ CMakeLists.txt      # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–±–æ—Ä–∫–∏ —Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è–º–∏
‚îú‚îÄ‚îÄ README.md           # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
‚îî‚îÄ‚îÄ CLAUDE.md           # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è Claude Code
```

## –ö–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

### cpu.c
- `start_cpu_clock()` - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è PWM clock –¥–ª—è i8086 (33% duty, 4 –ú–ì—Ü)
- `reset_cpu()` - RESET sequence (10 clocks LOW, 5 stabilization)

### cpu_bus.c
- `cpu_bus_init()` - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è PIO –∏ IRQ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å –≤—ã—Å–æ–∫–∏–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º
- `bus_read_handler()` - –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —á—Ç–µ–Ω–∏—è (IRQ1) + INTA cycles (IRQ3)
- `bus_write_handler()` - –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–ø–∏—Å–∏ (IRQ0)
- `i8086_read()` - `__force_inline` —á—Ç–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏/I/O —Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π –ø–æ—Ä—Ç–æ–≤
- `i8086_write()` - `__force_inline` –∑–∞–ø–∏—Å—å –ø–∞–º—è—Ç–∏/I/O —Å BHE –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π

### main.c
- `bus_handler_core()` - –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ Core1:
  - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∂–µ–ª–µ–∑–∞ (clock ‚Üí pic ‚Üí bus ‚Üí reset)
  - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è IRQ0 –∫–∞–∂–¥—ã–µ 54.925ms (18.2 Hz)
  - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–æ–º INTR
- `ascii_to_scancode()` - –ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä ASCII ‚Üí IBM PC/XT Scancode Set 1
- `push_scancode()` - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–∫–∞–Ω-–∫–æ–¥–∞ –≤ buffer + –≥–µ–Ω–µ—Ä–∞—Ü–∏—è IRQ1
- `pic_init()` - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è INTR –ø–∏–Ω–∞ –∫–∞–∫ output

### –î–µ—Ç–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª—é—á–µ–≤—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

**cpu_bus.c - –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä —à–∏–Ω—ã –∏ –ø–∞–º—è—Ç—å:**
- `i8086_read()`: –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —á—Ç–µ–Ω–∏–µ —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º –ø—Ä–æ–≤–µ—Ä–æ–∫:
  1. VGA port (0x3BA) - —Å–∞–º—ã–π —á–∞—Å—Ç—ã–π
  2. Keyboard ports (0x60-0x6F) - range check —á–µ—Ä–µ–∑ `(port & 0xFF0) == 0x60`
  3. –õ–æ–∫–∞–ª—å–Ω—ã–µ –∫–æ–ø–∏–∏ volatile –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –¥–ª—è –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–∞ –∫ –ø–∞–º—è—Ç–∏
- `i8086_write()`: –ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ 8/16 –±–∏—Ç–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —á–µ—Ä–µ–∑ BHE –∏ A0
- `bus_read_handler()`: –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç INTA (IRQ3) + –æ–±—ã—á–Ω–æ–µ —á—Ç–µ–Ω–∏–µ (IRQ1)
  - INTA path: –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `current_irq_vector`, –æ—á–∏—â–∞–µ—Ç —Ñ–ª–∞–≥–∏
  - –û–±—ã—á–Ω–æ–µ —á—Ç–µ–Ω–∏–µ: –≤—ã–∑—ã–≤–∞–µ—Ç `i8086_read()` —Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π `unlikely()`

**main.c - Keyboard & Video:**
- Circular buffer –Ω–∞ 16 –±–∞–π—Ç –¥–ª—è keyboard scancodes
- 60 FPS —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ –≤–∏–¥–µ–æ–ø–∞–º—è—Ç–∏ —á–µ—Ä–µ–∑ ANSI escape codes
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –±—É–∫–≤, —Ü–∏—Ñ—Ä, —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö –∫–ª–∞–≤–∏—à (Space, Enter, Backspace, Tab, Escape)
- QWERTY layout –¥–ª—è ASCII ‚Üí Scancode –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏

**i8086_bus.pio - –í—ã—Å–æ–∫–æ–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π state machine:**

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–≥—Ä–∞–º–º—ã:**
- `.side_set 1 opt` - –æ–¥–∏–Ω sideset –±–∏—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è READY
- `.define` —Å–µ–∫—Ü–∏—è —Å –∂–µ—Å—Ç–∫–æ –∑–∞–¥–∞–Ω–Ω—ã–º–∏ GPIO pin assignments
- –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª: `wait_ALE` ‚Üí `capture_address` ‚Üí `wait_strobe` ‚Üí `operation_cycle`

**–ö–ª—é—á–µ–≤—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**
- **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π polling**: –°–æ–∫—Ä–∞—â–µ–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –≤ —Ü–∏–∫–ª–µ –æ–ø—Ä–æ—Å–∞ RD/WR/INTA
- **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ —Ç–∞–π–º–∏–Ω–≥–∏**: Sideset delays —Å–æ–≤–º–µ—â–µ–Ω—ã —Å IRQ –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏ (`irq 0 side 1`)
- **–ë—ã—Å—Ç—Ä–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö**: –ï–¥–∏–Ω—ã–π 16-–±–∏—Ç–Ω—ã–π –¥–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ `in pins, 16` / `out pins, 16`
- **–î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞**: –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–≥–Ω–∞–ª–æ–≤ –±–µ–∑ —É—Å–ª–æ–≤–Ω—ã—Ö –ø–µ—Ä–µ—Ö–æ–¥–æ–≤

**–°–æ—Å—Ç–æ—è–Ω–∏—è PIO:**
1. `wait_ALE`: –û–∂–∏–¥–∞–Ω–∏–µ –Ω–∞—á–∞–ª–∞ —Ü–∏–∫–ª–∞ —à–∏–Ω—ã (ALE=HIGH)
2. `capture_address`: –ó–∞—Ö–≤–∞—Ç 26 –ø–∏–Ω–æ–≤ (–∞–¥—Ä–µ—Å + —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ) –ø—Ä–∏ ALE=LOW
3. `wait_strobe`: –û–ø—Ä–æ—Å —É–ø—Ä–∞–≤–ª—è—é—â–∏—Ö —Å–∏–≥–Ω–∞–ª–æ–≤ (RD/WR/INTA)
4. `RD_cycle`: –¶–∏–∫–ª —á—Ç–µ–Ω–∏—è —Å –≤—ã–≤–æ–¥–æ–º –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —à–∏–Ω—É
5. `WR_cycle`: –¶–∏–∫–ª –∑–∞–ø–∏—Å–∏ —Å –∑–∞—Ö–≤–∞—Ç–æ–º –¥–∞–Ω–Ω—ã—Ö —Å —à–∏–Ω—ã
6. `INTA_cycle`: –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è —á–µ—Ä–µ–∑ state machine
7. `cleanup`: –í–æ–∑–≤—Ä–∞—Ç —à–∏–Ω—ã –¥–∞–Ω–Ω—ã—Ö –≤ Z-—Å–æ—Å—Ç–æ—è–Ω–∏–µ

**C –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è PIO:**
```c
void i8086_bus_program_init(PIO pio, uint sm, uint offset)
{
    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ shift —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤
    sm_config_set_in_shift(&cfg, false, false, 32);   // IN: —Å–¥–≤–∏–≥ –≤–ª–µ–≤–æ
    sm_config_set_out_shift(&cfg, true, false, 32);   // OUT: —Å–¥–≤–∏–≥ –≤–ø—Ä–∞–≤–æ

    // –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø–∏–Ω–æ–≤
    sm_config_set_in_pins(&cfg, i8086_bus_AD_BUS_PINS);      // IN base = GPIO 0
    sm_config_set_out_pins(&cfg, i8086_bus_AD_BUS_PINS, 16); // OUT base = GPIO 0
    sm_config_set_sideset_pins(&cfg, i8086_bus_READY_PIN);   // SIDESET = GPIO 27
}
```

**–ü—Ä–µ—Ä—ã–≤–∞–Ω–∏—è –∏ –º–Ω–æ–≥–æ—è–¥–µ—Ä–Ω–æ—Å—Ç—å:**
- `pic_init()`: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç INTR –ø–∏–Ω (GPIO26) –∫–∞–∫ output, LOW –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- `bus_handler_core()`: –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ Core1:
  - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∂–µ–ª–µ–∑–∞: clock ‚Üí pic ‚Üí bus ‚Üí reset
  - –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç IRQ0 –∫–∞–∂–¥—ã–µ 54.925ms (18.2 Hz, IBM PC —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å)
  - –£–ø—Ä–∞–≤–ª—è–µ—Ç INTR: —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç HIGH –ø—Ä–∏ `current_irq_vector != 0`
- **INTA —á–µ—Ä–µ–∑ PIO**: –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –≤ state machine (IRQ 3)
- **Keyboard IRQ**: Core0 —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç IRQ1 –ø—Ä–∏ `push_scancode()` —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞
- **–£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**: –ù–µ—Ç multicore FIFO, –æ–¥–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `current_irq_vector`

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

**–¢–µ–∫—É—â–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å @ 400 MHz RP2040 / 4 MHz i8086:**
- **–î–æ—Å—Ç—É–ø–Ω–æ**: 100 —Ç–∞–∫—Ç–æ–≤ RP2040 –Ω–∞ bus cycle (400 MHz / 4 MHz)
- **–¢—Ä–µ–±—É–µ—Ç—Å—è**: ~75 —Ç–∞–∫—Ç–æ–≤ RP2040 (–∏–∑–º–µ—Ä–µ–Ω–æ —Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è–º–∏)
- **–ó–∞–ø–∞—Å**: 1.33x (–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã)
- **CPU –Ω–∞–≥—Ä—É–∑–∫–∞**: ~75% worst case (bus handlers + IRQ processing)

**–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:**
- ‚úÖ **800x —É—Å–∫–æ—Ä–µ–Ω–∏–µ**: 5 –ö–ì—Ü ‚Üí 4 –ú–ì—Ü (—Å—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞)
- ‚úÖ **60 FPS –≤–∏–¥–µ–æ**: Core0 —Ä–µ–Ω–¥–µ—Ä–∏—Ç VIDEORAM –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª
- ‚úÖ **18.2 Hz timer**: Core1 –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç IRQ0 (IBM PC —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å)
- ‚úÖ **Keyboard latency**: <1ms (IRQ1 generation on scancode push)
- ‚úÖ **–ù—É–ª–µ–≤—ã–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏**: `__force_inline` + `likely()`/`unlikely()` hints

**–ö–ª—é—á–µ–≤—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**
- ‚úÖ **–ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ –ø–∞–º—è—Ç–∏**: `*(uint16_t *)&RAM[address]` –±–µ–∑ boundary checks
- ‚úÖ **4-byte alignment**: RAM, ROM, VIDEORAM –¥–ª—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
- ‚úÖ **Range check –ø–æ—Ä—Ç–æ–≤**: `(port & 0xFF0) == 0x60` —ç–∫–æ–Ω–æ–º–∏—Ç 2-3 —Ç–∞–∫—Ç–∞
- ‚úÖ **Volatile minimization**: –õ–æ–∫–∞–ª—å–Ω—ã–µ –∫–æ–ø–∏–∏ `kb_head`, `kb_tail`
- ‚úÖ **Inline functions**: `__force_inline` –¥–ª—è i8086_read/write
- ‚úÖ **Compiler hints**: `likely()`/`unlikely()` –¥–ª—è branch prediction
- ‚úÖ **–£–≤–µ–ª–∏—á–µ–Ω–Ω–∞—è RAM**: 128KB ‚Üí 192KB (—É–¥–∞–ª–µ–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è)
- ‚úÖ **–ö–æ–º–ø–∏–ª—è—Ç–æ—Ä**: -Ofast, copy_to_ram, -ffunction-sections

### PIO State Machine

- –†–∞–±–æ—Ç–∞–µ—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç ARM —è–¥—Ä–∞
- –ß–∞—Å—Ç–æ—Ç–∞: –¥–æ 133 –ú–ì—Ü (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–∞–∑–≥–æ–Ω–∞ RP2040)
- –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π timing –¥–ª—è —Å–∏–≥–Ω–∞–ª–æ–≤ —à–∏–Ω—ã
- FIFO –¥–ª—è –æ–±–º–µ–Ω–∞ –¥–∞–Ω–Ω—ã–º–∏ —Å ARM
- **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π polling**: –°–æ–∫—Ä–∞—â–µ–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π
- **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö**: –ï–¥–∏–Ω—ã–π 16-–±–∏—Ç–Ω—ã–π –¥–æ—Å—Ç—É–ø

## –°—Ç–∞—Ç—É—Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### ‚úÖ –ü–û–õ–ù–ê–Ø –ü–û–î–î–ï–†–ñ–ö–ê –ö–õ–ê–í–ò–ê–¢–£–†–´ + –û–ü–¢–ò–ú–ò–ó–ò–†–û–í–ê–ù–ù–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê
- ‚úÖ –ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —ç–º—É–ª—è—Ç–æ—Ä Intel 8086 @ 4 –ú–ì—Ü
- ‚úÖ 192KB RAM + 8KB ROM (Turbo XT BIOS v3.1) + 4KB –≤–∏–¥–µ–æ–ø–∞–º—è—Ç—å MDA
- ‚úÖ –í—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä —à–∏–Ω—ã –Ω–∞ PIO
- ‚úÖ PWM –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ç–∞–∫—Ç–æ–≤ (4 –ú–ì—Ü, 33% duty cycle)
- ‚úÖ –ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ 8/16 –±–∏—Ç–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π (BHE handling)
- ‚úÖ **INTA —á–µ—Ä–µ–∑ PIO**: –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π –≤ state machine (IRQ 3)
- ‚úÖ **IRQ System**: IRQ0 (timer 18.2 Hz) + IRQ1 (keyboard) —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º–∏
- ‚úÖ **Keyboard controller**: –ü–æ—Ä—Ç—ã 0x60/0x64, IBM PC/XT —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
- ‚úÖ **ASCII ‚Üí Scancode**: QWERTY layout, –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã, —Å–ø–µ—Ü–∫–ª–∞–≤–∏—à–∏
- ‚úÖ **Real-time video**: 60 FPS –≤—ã–≤–æ–¥ VIDEORAM —á–µ—Ä–µ–∑ USB (Core0)
- ‚úÖ **VGA –ø–æ—Ä—Ç 0x3BA**: –≠–º—É–ª—è—Ü–∏—è vsync –±–∏—Ç–æ–≤
- ‚úÖ **Dual-core architecture**: Core0 (UI/keyboard), Core1 (bus/IRQ)

### –ü–æ—Å–ª–µ–¥–Ω–∏–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è üöÄ
- **800x —É—Å–∫–æ—Ä–µ–Ω–∏–µ**: 5 –ö–ì—Ü ‚Üí 4 –ú–ì—Ü (—Å—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞)
- **Keyboard support**: –ü–æ–ª–Ω–∞—è —ç–º—É–ª—è—Ü–∏—è IBM PC/XT –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
- **60 FPS video**: Real-time —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª
- **–£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**: –£–¥–∞–ª–µ–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–æ—Ä—Ç–æ–≤**: Range checks –¥–ª—è keyboard (—ç–∫–æ–Ω–æ–º–∏—è 2-3 —Ç–∞–∫—Ç–æ–≤)
- **Inline optimization**: `__force_inline` –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
- **RAM —É–≤–µ–ª–∏—á–µ–Ω–∞**: 128KB ‚Üí 192KB
- **Branch prediction**: `likely()`/`unlikely()` hints

### TODO (–§–∞–∑–∞ 2)

- [x] –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π INTR/INTA ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û
- [x] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ BHE –¥–ª—è 8/16 –±–∏—Ç–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û
- [x] –í–∏–¥–µ–æ–ø–∞–º—è—Ç—å MDA ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û
- [x] Real-time –≤–∏–¥–µ–æ–≤—ã–≤–æ–¥ ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û
- [x] 800x —É—Å–∫–æ—Ä–µ–Ω–∏–µ (5 –ö–ì—Ü ‚Üí 4 –ú–ì—Ü) ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û
- [x] Keyboard controller (IBM PC/XT) ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û
- [x] Dual-core architecture optimization ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û
- [ ] –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —á–∞—Å—Ç–æ—Ç—ã –¥–æ 5+ –ú–ì—Ü (—Ç—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π)
- [ ] –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ I/O —É—Å—Ç—Ä–æ–π—Å—Ç–≤ (UART, PIT hardware emulation)
- [ ] –ü–æ–ª–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å 8259A (ICW1-ICW4, OCW1-OCW3, –º–∞—Å–∫–∏ IRQ)
- [ ] –í–Ω–µ—à–Ω–∏–µ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è –∏ DMA
- [ ] –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–∏–¥–µ–æ—Ä–µ–∂–∏–º—ã (CGA/EGA —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å)

## –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

```bash
mkdir cmake-build-release
cd cmake-build-release
cmake --build .
```

–†–µ–∑—É–ª—å—Ç–∞—Ç: `cmake-build-release/bin/rp2040/Release/MultiIO.uf2` –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ RP2040

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Pico SDK
- CMake >= 3.13
- GCC ARM toolchain
- –ö–∏—Ç–∞–π—Å–∫–∞—è —Ñ–∏–æ–ª–µ—Ç–æ–≤–∞—è –ø–ª–∞—Ç–∞ RP2040 (–≤—Å–µ 30 GPIO –¥–æ—Å—Ç—É–ø–Ω—ã)


## –õ–∏—Ü–µ–Ω–∑–∏—è

–ù–µ —É–∫–∞–∑–∞–Ω–∞
