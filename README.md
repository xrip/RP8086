# RP8086 - –ß–∏–ø—Å–µ—Ç i8086 –Ω–∞ –±–∞–∑–µ RP2040

## –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

RP8086 - —ç—Ç–æ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ-–∞–ø–ø–∞—Ä–∞—Ç–Ω—ã–π –∫–æ–º–ø–ª–µ–∫—Å, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–π –∫–∏—Ç–∞–π—Å–∫—É—é —Ñ–∏–æ–ª–µ—Ç–æ–≤—É—é –ø–ª–∞—Ç—É RP2040 (Raspberry Pi Pico) –≤ –∫–∞—á–µ—Å—Ç–≤–µ —á–∏–ø—Å–µ—Ç–∞ –¥–ª—è –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞ Intel 8086. RP2040 —ç–º—É–ª–∏—Ä—É–µ—Ç:

- ‚úÖ –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä —Å–∏—Å—Ç–µ–º–Ω–æ–π —à–∏–Ω—ã (PIO hardware)
- ‚úÖ –≠–º—É–ª—è—Ç–æ—Ä ROM (8KB GlaBIOS)
- ‚úÖ –≠–º—É–ª—è—Ç–æ—Ä RAM (224KB)
- ‚úÖ –í–∏–¥–µ–æ–ø–∞–º—è—Ç—å MDA (4KB)
- ‚úÖ I/O –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä
- ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ç–∞–∫—Ç–æ–≤–æ–≥–æ —Å–∏–≥–Ω–∞–ª–∞ (PWM, 33% duty cycle)
- ‚úÖ –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π 8259A (INTR/INTA protocol, multicore)

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ**: RP2040 —Ç–æ–ª–µ—Ä–∞–Ω—Ç–Ω–∞ –∫ 5–í –Ω–∞ –≤—Ö–æ–¥–µ, –ø–æ—ç—Ç–æ–º—É –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ level shifters –Ω–µ —Ç—Ä–µ–±—É—é—Ç—Å—è –¥–ª—è –ø—Ä—è–º–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ i8086.

**–°—Ç–∞—Ç—É—Å**: –§–∞–∑–∞ 1 –∑–∞–≤–µ—Ä—à–µ–Ω–∞ - –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–±–æ—á–∏–π –ø—Ä–æ—Ç–æ—Ç–∏–ø –≥–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –Ω–∞ –∂–µ–ª–µ–∑–µ.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

1. **PIO (Programmable I/O)** - –∞–ø–ø–∞—Ä–∞—Ç–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä —à–∏–Ω—ã
   - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —á—Ç–µ–Ω–∏—è/–∑–∞–ø–∏—Å–∏ –Ω–∞ –∞–ø–ø–∞—Ä–∞—Ç–Ω–æ–º —É—Ä–æ–≤–Ω–µ
   - –£–ø—Ä–∞–≤–ª—è–µ—Ç —Å–∏–≥–Ω–∞–ª–∞–º–∏ READY (wait states)
   - –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏ –±–ª–∞–≥–æ–¥–∞—Ä—è hardware timing

2. **ARM Cortex-M0+** - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–∞–Ω–Ω—ã—Ö
   - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è –æ—Ç PIO
   - –≠–º—É–ª–∏—Ä—É–µ—Ç –ø–∞–º—è—Ç—å –∏ I/O –ø–æ—Ä—Ç—ã
   - –†–∞–±–æ—Ç–∞–µ—Ç —Å –∫—Ä–∏—Ç–∏—á–Ω—ã–º –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –∫–æ–¥–æ–º (`__time_critical_func`)

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ GPIO

| GPIO | –°–∏–≥–Ω–∞–ª | –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|--------|-------------|----------|
| 0-15 | AD0-AD15 | –î–≤—É–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è | –ú—É–ª—å—Ç–∏–ø–ª–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —à–∏–Ω–∞ –∞–¥—Ä–µ—Å–∞/–¥–∞–Ω–Ω—ã—Ö (16 –±–∏—Ç) |
| 16-19 | A16-A19 | –í—ã—Ö–æ–¥ | –°—Ç–∞—Ä—à–∏–µ –±–∏—Ç—ã –∞–¥—Ä–µ—Å–∞ (4 –±–∏—Ç–∞) |
| 20 | ALE | –í—Ö–æ–¥ | Address Latch Enable - –∑–∞—â–µ–ª–∫–∞ –∞–¥—Ä–µ—Å–∞ |
| 21 | RD | –í—Ö–æ–¥ | Read strobe - —Å–∏–≥–Ω–∞–ª —á—Ç–µ–Ω–∏—è (–∞–∫—Ç–∏–≤–Ω—ã–π LOW) |
| 22 | WR | –í—Ö–æ–¥ | Write strobe - —Å–∏–≥–Ω–∞–ª –∑–∞–ø–∏—Å–∏ (–∞–∫—Ç–∏–≤–Ω—ã–π LOW) |
| 23 | INTA | –í—Ö–æ–¥ | Interrupt acknowledge –æ—Ç i8086 (–∞–∫—Ç–∏–≤–Ω—ã–π LOW) |
| 24 | M/IO | –í—Ö–æ–¥ | Memory/IO select (1=–ø–∞–º—è—Ç—å, 0=I/O) |
| 25 | BHE | –í—Ö–æ–¥ | Bus High Enable (–ø–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ 8/16 –±–∏—Ç) |
| 26 | INTR | –í—ã—Ö–æ–¥ | Interrupt request –¥–ª—è i8086 (–∞–∫—Ç–∏–≤–Ω—ã–π HIGH) |
| 27 | READY | –í—ã—Ö–æ–¥ | Wait state control –¥–ª—è CPU (0=wait, 1=ready) |
| 28 | RESET | –í—ã—Ö–æ–¥ | Reset –¥–ª—è i8086 (–∞–∫—Ç–∏–≤–Ω—ã–π LOW) |
| 29 | CLK | –í—ã—Ö–æ–¥ | –¢–∞–∫—Ç–æ–≤—ã–π —Å–∏–≥–Ω–∞–ª –¥–ª—è i8086 (PWM, 100 –ì—Ü) |


## –ü—Ä–æ—Ç–æ–∫–æ–ª —Ä–∞–±–æ—Ç—ã —à–∏–Ω—ã

### –¶–∏–∫–ª —á—Ç–µ–Ω–∏—è (RD)

1. **T1 —Ñ–∞–∑–∞**: CPU –≤—ã—Å—Ç–∞–≤–ª—è–µ—Ç –∞–¥—Ä–µ—Å –Ω–∞ AD0-AD15 + A16-A19, –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç ALE=HIGH
2. **T2 —Ñ–∞–∑–∞**: PIO –∑–∞—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç 25 –ø–∏–Ω–æ–≤ (–∞–¥—Ä–µ—Å + —É–ø—Ä–∞–≤–ª—è—é—â–∏–µ —Å–∏–≥–Ω–∞–ª—ã), ALE=LOW
3. **T2-T3 —Ñ–∞–∑–∞**: PIO –ø–æ–¥–Ω–∏–º–∞–µ—Ç READY=1 (insert wait state), –æ–ø—Ä–∞—à–∏–≤–∞–µ—Ç RD/WR
4. **–ü—Ä–∏ RD=LOW**: PIO –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç IRQ1 (–∑–∞–ø—Ä–æ—Å —á—Ç–µ–Ω–∏—è)
5. **–û–±—Ä–∞–±–æ—Ç–∫–∞ IRQ1**: ARM —á–∏—Ç–∞–µ—Ç –∞–¥—Ä–µ—Å –∏–∑ FIFO, –≤—ã–ø–æ–ª–Ω—è–µ—Ç `cpu_bus_read()`
6. **–í–æ–∑–≤—Ä–∞—Ç –¥–∞–Ω–Ω—ã—Ö**: ARM –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 16 –±–∏—Ç –¥–∞–Ω–Ω—ã—Ö –≤ FIFO PIO
7. **T3-T4 —Ñ–∞–∑–∞**: PIO –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç AD0-AD15 –Ω–∞ –≤—ã—Ö–æ–¥, –≤—ã—Å—Ç–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ
8. **READY —Å–∏–≥–Ω–∞–ª**: PIO –æ–ø—É—Å–∫–∞–µ—Ç READY=0 (–¥–∞–Ω–Ω—ã–µ –≥–æ—Ç–æ–≤—ã), CPU —Å—á–∏—Ç—ã–≤–∞–µ—Ç
9. **–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ**: –ü–æ RD=HIGH PIO –ø–µ—Ä–µ–≤–æ–¥–∏—Ç AD0-AD15 –≤ Z-—Å–æ—Å—Ç–æ—è–Ω–∏–µ (–≤—Ö–æ–¥—ã)

### –¶–∏–∫–ª –∑–∞–ø–∏—Å–∏ (WR)

1. **T1 —Ñ–∞–∑–∞**: CPU –≤—ã—Å—Ç–∞–≤–ª—è–µ—Ç –∞–¥—Ä–µ—Å –Ω–∞ AD0-AD15 + A16-A19, –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç ALE=HIGH
2. **T2 —Ñ–∞–∑–∞**: PIO –∑–∞—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç 25 –ø–∏–Ω–æ–≤ (–∞–¥—Ä–µ—Å + —É–ø—Ä–∞–≤–ª—è—é—â–∏–µ —Å–∏–≥–Ω–∞–ª—ã), ALE=LOW
3. **T2-T3 —Ñ–∞–∑–∞**: PIO –ø–æ–¥–Ω–∏–º–∞–µ—Ç READY=1 (insert wait state), –æ–ø—Ä–∞—à–∏–≤–∞–µ—Ç RD/WR
4. **–ü—Ä–∏ WR=LOW**: PIO –∑–∞—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç 16 –±–∏—Ç –¥–∞–Ω–Ω—ã—Ö —Å AD0-AD15
5. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è IRQ0**: PIO –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ FIFO, –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ
6. **–û–±—Ä–∞–±–æ—Ç–∫–∞ IRQ0**: ARM —á–∏—Ç–∞–µ—Ç –∞–¥—Ä–µ—Å + –¥–∞–Ω–Ω—ã–µ –∏–∑ FIFO, –≤—ã–ø–æ–ª–Ω—è–µ—Ç `cpu_bus_write()`
7. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è**: IRQ0 —Å–æ–≤–º–µ—â–µ–Ω —Å READY=0 —á–µ—Ä–µ–∑ `side 0 [3]` –∑–∞–¥–µ—Ä–∂–∫—É
8. **–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ**: –ü–æ WR=HIGH PIO –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (–æ–∂–∏–¥–∞–Ω–∏–µ ALE)

## –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### –≠–º—É–ª–∏—Ä—É–µ–º—ã–µ I/O –ø–æ—Ä—Ç—ã

–í –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è —ç–º—É–ª—è—Ü–∏—è I/O –ø–æ—Ä—Ç–æ–≤ —Å –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–æ–º –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –§–∏–±–æ–Ω–∞—á—á–∏:

| –ü–æ—Ä—Ç | –†–µ–∂–∏–º | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-------|----------|
| 0x00 | R/W | –ú–ª–∞–¥—à–∏–π –±–∞–π—Ç —á–∏—Å–ª–∞ –§–∏–±–æ–Ω–∞—á—á–∏ / –°–±—Ä–æ—Å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ |

#### –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è (x86 Assembly)

```assembly
; –°–±—Ä–æ—Å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –§–∏–±–æ–Ω–∞—á—á–∏
mov al, 0
out 0, al

; –ß—Ç–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ —á–∏—Å–ª–∞ –§–∏–±–æ–Ω–∞—á—á–∏ (16 –±–∏—Ç)
in al, 0      ; –ú–ª–∞–¥—à–∏–π –±–∞–π—Ç
mov bl, al
in al, 1      ; –°—Ç–∞—Ä—à–∏–π –±–∞–π—Ç
mov bh, al    ; bx = —á–∏—Å–ª–æ –§–∏–±–æ–Ω–∞—á—á–∏

; –ö–∞–∂–¥–æ–µ —á—Ç–µ–Ω–∏–µ –∏–∑ –ø–æ—Ä—Ç–∞ 0 –ø—Ä–æ–¥–≤–∏–≥–∞–µ—Ç –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å
in al, 0      ; –°–ª–µ–¥—É—é—â–µ–µ —á–∏—Å–ª–æ
```

### –ö–∞—Ä—Ç–∞ –ø–∞–º—è—Ç–∏

```
0x00000 - 0x37FFF : RAM (224KB)
0x38000 - 0xAFFFF : Unmapped (returns 0xFFFF)
0xB0000 - 0xB7FFF : Video RAM MDA (4KB)
0xB8000 - 0xFDFFF : Unmapped (returns 0xFFFF)
0xFE000 - 0xFFFFF : ROM GlaBIOS (8KB)
```

### USB –∫–æ–º–∞–Ω–¥—ã (main.c)

- **'M'**: –î–∞–º–ø –ø–∞–º—è—Ç–∏ (–ø–µ—Ä–≤—ã–µ 400 –±–∞–π—Ç)
- **'V'**: –î–∞–º–ø –≤–∏–¥–µ–æ–ø–∞–º—è—Ç–∏ (160x25 —Å–∏–º–≤–æ–ª–æ–≤)
- **'P'**: –î–∞–º–ø –ø–æ—Ä—Ç–æ–≤ –≤–≤–æ–¥–∞-–≤—ã–≤–æ–¥–∞ (–ø–µ—Ä–≤—ã–µ 400 –±–∞–π—Ç)
- **'R'**: –°–±—Ä–æ—Å CPU
- **'B'**: –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –≤ bootloader mode

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
RP8086/
‚îú‚îÄ‚îÄ main.c              # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞, Core1 IRQ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä, USB –∫–æ–º–∞–Ω–¥—ã
‚îú‚îÄ‚îÄ cpu.c/h             # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ i8086 (clock, reset)
‚îú‚îÄ‚îÄ cpu_bus.c/h         # –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä —à–∏–Ω—ã, —ç–º—É–ª—è—Ü–∏—è –ø–∞–º—è—Ç–∏, INTA –æ–±—Ä–∞–±–æ—Ç–∫–∞
‚îú‚îÄ‚îÄ i8086_bus.pio       # PIO –ø—Ä–æ–≥—Ä–∞–º–º–∞ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ —à–∏–Ω—ã —Å INTA –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π
‚îú‚îÄ‚îÄ config.h            # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è GPIO –∏ —Å–∏—Å—Ç–µ–º—ã
‚îú‚îÄ‚îÄ bios.h              # GlaBIOS ROM –æ–±—Ä–∞–∑ (8KB)
‚îú‚îÄ‚îÄ CMakeLists.txt      # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–±–æ—Ä–∫–∏
‚îú‚îÄ‚îÄ README.md           # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
‚îî‚îÄ‚îÄ CLAUDE.md           # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è Claude Code
```

## –ö–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

### cpu.c
- `start_cpu_clock()` - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è PWM clock –¥–ª—è i8086 (33% duty, 400 –ú–ì—Ü)
- `reset_cpu()` - RESET sequence (10 clocks LOW, 5 stabilization)

### cpu_bus.c
- `cpu_bus_init()` - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è PIO –∏ IRQ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
- `bus_read_handler()` - –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —á—Ç–µ–Ω–∏—è (IRQ1)
- `bus_write_handler()` - –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–ø–∏—Å–∏ (IRQ0)
- `cpu_bus_read()` - **–£–ª—å—Ç—Ä–∞-–±—ã—Å—Ç—Ä–æ–µ** —á—Ç–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ via aligned access
- `cpu_bus_write()` - **–£–ª—å—Ç—Ä–∞-–±—ã—Å—Ç—Ä–∞—è** –∑–∞–ø–∏—Å—å –ø–∞–º—è—Ç–∏ via aligned access

### –ü—Ä–µ—Ä—ã–≤–∞–Ω–∏—è (–∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ main.c/cpu_bus.c)
- `pic_init()` - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è INTR –ø–∏–Ω–∞ –∏ –∑–∞–ø—É—Å–∫ Core1
- `core1_irq_generator()` - –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä IRQ0 –Ω–∞ Core1 (~549ms –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏, 18.2 Hz –≤ –Ω–æ—Ä–º–µ)
- **INTA —á–µ—Ä–µ–∑ PIO**: –û–±—Ä–∞–±–æ—Ç–∫–∞ INTA –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ –≤ state machine (IRQ 3)
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ READY –≤–æ –≤—Ä–µ–º—è INTA
  - –í–æ–∑–≤—Ä–∞—Ç –≤–µ–∫—Ç–æ—Ä–∞ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è 0x08 —á–µ—Ä–µ–∑ cpu_bus_read

### i8086_bus.pio
–í—ã—Å–æ–∫–æ–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π PIO state machine:
- **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π polling**: RD/WR/INTA detection —Å —Å–æ–∫—Ä–∞—â–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º
- **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ —Ç–∞–π–º–∏–Ω–≥–∏**: sideset delays —Å–æ–≤–º–µ—â–µ–Ω—ã —Å IRQ
- **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏**: –£–¥–∞–ª–µ–Ω—ã –ª–∏—à–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ 20-–±–∏—Ç–Ω–æ–≥–æ –∞–¥—Ä–µ—Å–∞ + BHE
- **INTA –ø–æ–¥–¥–µ—Ä–∂–∫–∞**: –û—Ç–¥–µ–ª—å–Ω—ã–π —Ü–∏–∫–ª –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π (IRQ 3)
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ READY –¥–ª—è wait states (side 0 [3] optimization)
- –ë—ã—Å—Ç—Ä–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è —à–∏–Ω—ã –¥–∞–Ω–Ω—ã—Ö

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

**–ë–∞–∑–æ–≤–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
- **Zero-wait state –¥–æ—Å—Ç—É–ø**: PIO –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —à–∏–Ω—É –±–µ–∑ –∑–∞–¥–µ—Ä–∂–µ–∫
- **Hardware timing**: –í—Å–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ PIO
- **–ö—Ä–∏—Ç–∏—á–Ω—ã–π –∫–æ–¥**: –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø–æ–º–µ—á–µ–Ω—ã `__time_critical_func` –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –≤ RAM
- **–í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: –ü—Ä–µ—Ä—ã–≤–∞–Ω–∏—è —à–∏–Ω—ã –∏–º–µ—é—Ç `PICO_HIGHEST_IRQ_PRIORITY`

**–ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (—É–ª—É—á—à–µ–Ω–∏–µ –Ω–∞ 40-60%):**
- **–í—ã—Ä–æ–≤–Ω–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –ø–∞–º—è—Ç–∏**: Single 16-bit access —á–µ—Ä–µ–∑ `address & ~1U`
- **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–∞—Å—Å–∏–≤—ã**: 4-byte alignment –¥–ª—è RAM –∏ ROM
- **–£—Å–∫–æ—Ä–µ–Ω–Ω—ã–π PIO**: –£–¥–∞–ª–µ–Ω—ã —É—Å–ª–æ–≤–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã, —Å–æ–∫—Ä–∞—â–µ–Ω —Ü–∏–∫–ª –æ–ø—Ä–æ—Å–∞
- **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ —Ç–∞–π–º–∏–Ω–≥–∏**: Sideset delays —Å–æ–≤–º–µ—â–µ–Ω—ã —Å IRQ –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏
- **CPU –Ω–∞–≥—Ä—É–∑–∫–∞**: –°–Ω–∏–∂–µ–Ω–∞ —Å ~40% –¥–æ ~25% –Ω–∞ 5 –ú–ì—Ü

### PIO State Machine

- –†–∞–±–æ—Ç–∞–µ—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç ARM —è–¥—Ä–∞
- –ß–∞—Å—Ç–æ—Ç–∞: –¥–æ 133 –ú–ì—Ü (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–∞–∑–≥–æ–Ω–∞ RP2040)
- –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π timing –¥–ª—è —Å–∏–≥–Ω–∞–ª–æ–≤ —à–∏–Ω—ã
- FIFO –¥–ª—è –æ–±–º–µ–Ω–∞ –¥–∞–Ω–Ω—ã–º–∏ —Å ARM
- **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π polling**: –°–æ–∫—Ä–∞—â–µ–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π
- **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö**: –ï–¥–∏–Ω—ã–π 16-–±–∏—Ç–Ω—ã–π –¥–æ—Å—Ç—É–ø

## –°—Ç–∞—Ç—É—Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –§–∞–∑–∞ 1 ‚úÖ –ó–ê–í–ï–†–®–ï–ù–ê
- ‚úÖ –ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —ç–º—É–ª—è—Ç–æ—Ä Intel 8086
- ‚úÖ 224KB RAM + 8KB ROM (GlaBIOS) + 4KB –≤–∏–¥–µ–æ–ø–∞–º—è—Ç—å MDA
- ‚úÖ –í—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä —à–∏–Ω—ã –Ω–∞ PIO
- ‚úÖ PWM –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ç–∞–∫—Ç–æ–≤ (100 –ì—Ü –æ—Ç–ª–∞–¥–∫–∞, –≥–æ—Ç–æ–≤ –∫ 5 –ú–ì—Ü)
- ‚úÖ –ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ 8/16 –±–∏—Ç–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π (BHE handling)
- ‚úÖ **INTA —á–µ—Ä–µ–∑ PIO**: –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π –≤ state machine (IRQ 3)
- ‚úÖ **INTR –Ω–∞ Core1**: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π (GPIO26, 18.2 Hz)
- ‚úÖ –í–∏–¥–µ–æ–ø–∞–º—è—Ç—å MDA (0xB0000-0xB7FFF) —Å –≤—ã–≤–æ–¥–æ–º —á–µ—Ä–µ–∑ USB
- ‚úÖ –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ I/O –ø–æ—Ä—Ç—ã (0x40, 0x41, 0x61, 0x21)

### –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ üöÄ
- **40-60% —É—Å–∫–æ—Ä–µ–Ω–∏–µ** –æ–ø–µ—Ä–∞—Ü–∏–π —Å –ø–∞–º—è—Ç—å—é
- **4-byte alignment** –º–∞—Å—Å–∏–≤–æ–≤ RAM –∏ ROM
- **Address alignment** —á–µ—Ä–µ–∑ `address & ~1U` –¥–ª—è single 16-bit access
- **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π PIO** —Å INTA –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π
- **–°–Ω–∏–∂–µ–Ω–∏–µ CPU –Ω–∞–≥—Ä—É–∑–∫–∏** —Å 40% –¥–æ 25%
- **–ù–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π** —á–µ—Ä–µ–∑ PIO –≤–º–µ—Å—Ç–æ GPIO

### TODO (–§–∞–∑–∞ 2)

- [x] –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π INTR/INTA ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û
- [x] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ BHE –¥–ª—è 8/16 –±–∏—Ç–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û
- [x] –í–∏–¥–µ–æ–ø–∞–º—è—Ç—å MDA ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û
- [ ] –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ I/O —É—Å—Ç—Ä–æ–π—Å—Ç–≤ (UART, PIT)
- [ ] –ü–æ–ª–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å 8259A (ICW1-ICW4, OCW1-OCW3, –º–∞—Å–∫–∏ IRQ)
- [ ] –í–Ω–µ—à–Ω–∏–µ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è –∏ DMA
- [ ] –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —á–∞—Å—Ç–æ—Ç—ã –¥–æ —Ä–∞–±–æ—á–∏—Ö 5 –ú–ì—Ü+

## –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

```bash
mkdir cmake-build-release
cd cmake-build-release
cmake --build .
```

–†–µ–∑—É–ª—å—Ç–∞—Ç: `cmake-build-release/bin/rp2040/Release/MultiIO.uf2` –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ RP2040

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Pico SDK
- CMake >= 3.13
- GCC ARM toolchain
- –ö–∏—Ç–∞–π—Å–∫–∞—è —Ñ–∏–æ–ª–µ—Ç–æ–≤–∞—è –ø–ª–∞—Ç–∞ RP2040 (–≤—Å–µ 30 GPIO –¥–æ—Å—Ç—É–ø–Ω—ã)


## –õ–∏—Ü–µ–Ω–∑–∏—è

–ù–µ —É–∫–∞–∑–∞–Ω–∞
